package me.katze.gui4s.widget.library

import cats.syntax.all.*
import cats.{Functor, Monad}
import me.katze.gui4s.widget.free.AsFree
import me.katze.gui4s.widget.handle.handlesNothing
import me.katze.gui4s.widget.merge.anyHasNothingToMerge
import me.katze.gui4s.widget.recomposition.hasNoReactionOnRecomposition
import me.katze.gui4s.widget.state.hasNoInnerState
import _root_.me.katze.gui4s.geometry.Rect
import catnip.syntax.all.{*, given}
import me.katze.gui4s.layout.{*, given}

def drawOnlyWidget[
  T,
  Update[_] : Monad as M,
  Place[_] : Functor,
  Draw,
  RecompositionReaction,
  HandleableEvent,
  MeasurementUnit,
](
  original : Place[Sized[MeasurementUnit, Widget.ValueWrapper[T, Update, Place * Sized[MeasurementUnit, *], Draw, RecompositionReaction, HandleableEvent]]],
  toDraw : (Draw, Rect[MeasurementUnit]) => Draw
) : Place[Widget[Update, Place * Sized[MeasurementUnit, *], Draw, RecompositionReaction, HandleableEvent]] =
  original.map(
    sizedWidget =>
      sizedWidget.mapValue(
        widget =>
          valueIsDrawable = value => toDraw(widget.valueIsDrawable(value), sizedWidget.size)
      )
  )
end drawOnlyWidget
